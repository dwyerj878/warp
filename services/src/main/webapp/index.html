<html>
<head>
<!-- <meta http-equiv="Refresh" content="0; URL=index.jsf">  -->
<title>here we are</title>
</head>
<body>

	<script type="text/javascript" src="knockout-3.2.0.js"> </script>
	<script type="text/javascript" src="rest.js"> </script>
	<div id="main" class="main">
		New item: <input  data-bind='value: itemToAdd, valueUpdate: "afterkeydown"' />
		<button data-bind="enable: itemToAdd().length > 0, click: addItem">Add</button>
		<hr>
		<p>Your items:</p>
		<select multiple="multiple" size="5" data-bind="options: items">
		</select>
		
		<p>Users</p>
		<table border="1" style="border-color: #ff0000 #000000;border-style: 5; border-indent=3; border-collapse:collapse;">
			<thead>
				<td>idx</td>
				<td>id</td>
				<td>name</td>
				<td>email</td>
				<td>Phone #</td>
			</thead>
			<tbody data-bind="foreach: users">
				<tr>
					<td data-bind="text: $index"></td>
					<td data-bind="text: id"></td>
					<td data-bind="text: name"></td>
					<td data-bind="text: email"></td>
					<td data-bind="text: phoneNumber"></td>
				</tr>				
			</tbody>
			<tfoot>
				<td>New</td>
				<td><button data-bind="enable: newUserName().length > 0 && newUserEmail().length > 0, click: addUser">Save</button></td>
				<td> <input  data-bind='value: newUserName, valueUpdate: "afterkeydown"' /></td>
				<td> <input  data-bind='value: newUserEmail, valueUpdate: "afterkeydown"' /></td>
				<td> <input  data-bind='value: newPhoneNumber, valueUpdate: "afterkeydown"' /></td>
			</tfoot>
			
		</table>
	</div>


	<script type="text/javascript">
	function PageModel() {
		console.log("Create Model");    			
	    this.items = ko.observableArray(["Alpha", "Beta", "Gamma"]);
	    this.itemToAdd = ko.observable("");
	    this.users = ko.observableArray([]);
	    this.newUserName = ko.observable("");
	    this.newUserEmail = ko.observable("");
	    this.newPhoneNumber = ko.observable("");

	    this.updateUsers = function() {
	    	this.users.removeAll();    		
			console.log("Updating user list");
		    var foundUsers = MemberResourceRESTService.listAllMembers();		    
		    console.log("Found " +foundUsers.length + " users");
		    
		    for (var i =0; i < foundUsers.length; i++) {
			    var user = foundUsers[i];		    	
		    	this.users.push(user);
		    	console.log(user);
		    	
		    }
		    console.log("Updated user list " + this.users().length);
		    
		}.bind(this);

		this.addUser = function() {
			var entity={name:this.newUserName(), email:this.newUserEmail(), phoneNumber:this.newPhoneNumber()};
			var req = {$entity:entity};
			MemberResourceRESTService.createMember(req);
			this.updateUsers();
		}.bind(this);
	    
	    this.addItem = function() {
	        if (this.itemToAdd() != "") {
	            this.items.push(this.itemToAdd()); // Adds the item. Writing to the "items" observableArray causes any associated UI to update.
	            console.log("added " + this.itemToAdd() + " total items " + this.items().length);
	            this.itemToAdd(""); // Clears the text box, because it's bound to the "itemToAdd" observable
	            
	        }
	    }.bind(this);  // Ensure that "this" is always this view model
	    
	    this.updateUsers();

	    
	};
	model = new PageModel(); 

	ko.applyBindings(model);
</script>


</body>
</html>
